### DDIA读书笔记第3章

这章名字是存储与检索，简单介绍了各种数据库是如何存储数据和查询数据的。相比专门讲单一数据库的书，整体上讲得比较浅显，只是简单的提了下原理，感觉不是太容易懂，如果没有学过相关的知识估计看这个完全是云里雾里。还有就是这本书看到现在有一种在描述上有一种怪怪的感觉，很多地方觉得语言上不太流畅，这个也行是翻译的原因。

数据库一般包括数据文件和索引文件，数据文件中保存着大量记录，如果没有索引则查找一个数据需要从头开始扫描数据文件，这个是没法接收的，所以为了高效查找数据创造了索引结构。索引是数据的附加结构，添加、删除索引并不影响数据，只是影响查询性能。维护额外的结构一般会拖慢写入性能，所以并不能给所有结构都在一开始时就加上索引，需要根据查询的条件选择性的添加。

哈希索引：在数据文件中写入数据时，在内存中保存数据地址的映射。优点是查询快，缺点是内存里必须保存所有键，一旦重启索引就丢失了，也可以在重启时重建哈希索引，但是数据量大的话重建就比较耗时。如果将哈希索引保存在磁盘中，由于需要大量随机IO，所以哈希索引不适合用磁盘存储，只能放内存。

SSTables：看完这个我的理解就是稀疏索引，数据按序一段一段的存储，索引里不需要记录所有的键，只需要记录一部分，查找的时候找到第一个相近的索引，然后找到对应的数据文件往后遍历。索引结构一般可以用平衡树来保存。如果查找不存在的数据，可能要扫描比较多的数据，为了优化性能可以用所有键构建一个布隆过滤器，不存在的查找可以直接过滤掉。

B树：B树是按照键的顺序构建一个树，将数据库分解成大小固定的页，一次只能读取或者写入一个页，每个页面负责一个连续的键，存了子页面的键的范围和引用。查找时先在根所在的页找，接着根据键的大小找到根的子页。插入时，找到对应的键应该插入的页，如果该页空间不够，就将该页分成两个页。更新时就更新对应页面的值再刷回磁盘。为了防止刷页数据时失败丢失数据，一般用write ahead log技术，在刷页面时先写日志，如果刷失败用日志恢复。

列存储：通常表里有很多列数据，可能百来列，但是一般查询时也就需要四五列，大多数数据库都是行式布局的，可能导致需要读取大量不需要的数据，列式存储能解决这个问题，通常列里的数据可能有大量的重复，然后压缩比率会异常大。列存储一般只能顺序写入，更新的话成本很大，因为更新操作必须更新对应的行。