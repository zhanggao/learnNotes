### DDIA读书笔记第4周第5章 复制

本章主要讲的是分布式环境下集群数据一致性的问题。集群可以做到让用户访问理自己近的机器减少延迟、部分出现故障也能正常提供服务、扩展系统吞吐量。复制的主要难点是数据一直在变，变化要同步到其它机器，所有机器得保持一致。复制的方式主要有三种：单领导者、多领导者、无领导者。
领导者与追随者：每一次向数据库的写入都需要复制到所有副本上，最常见的解决方案就是领导者复制到追随者，客户端写入数据时必须写到主库，主库先存到本地然后主库再复制到从库。每个从库按照主库的写入顺序同步数据。客户端读取数据既可以访问从，也可以访问主。
主从关系处理：客户端向主库写入数据，主库本地存储成功并且从库也复制成功后再返回是同步复制：主库存储本地成功后立马返回再复制到从库，这种方式是异步复制。增加从库时，从库先获取主库的快照，写成功后再获取主库这之后发生的所有逻辑变更，当从库处理完积压后就能开始正常提供服务。当从库崩溃恢复后可以根据本地日志的最新的事务得到主库这之后的所有变更，拿到变更后再应用。当主库失效后，则需要进行选举，选择一个数据最新的从库为主库。
复制的实现：主从复制一般是通过日志，有两种日志，一直是基于语句的日志，一种是逻辑日志。一条插入语句逻辑日志会包含所有的插入行，删除语句则记录所有删除行的主键、更新语句则记录主键和所有更新的列的值。
读写一致性：比如用户信息，读自己的信息可以从主库读，读别人的可以从从库读。还可以不同的用户固定路由到不同的数据中心。
