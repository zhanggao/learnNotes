### DDIA读书笔记第5周第6章 分区

上一章复制讲的是主从。这章是分区。复制和分区相关的东西曾经零零散散的看过不少相关文章，所以这两章看到的大多数东西都是比较熟悉的，理解起来没什么障碍。分区主要是为了解决数据量或者请求过大的问题，非常高的数据量或者吞吐量，单机无法承担，需要将数据分区。复制是为了数据的可靠性，分区是为了拓展性。分区通常和复制结合，每个分区都分配一定的从节点可以同时解决可靠性和拓展性的问题。

分区的方式主要有根据键的范围、键的散列值分区；由于键的分布不均匀，或者热数据的问题都会导致某个分区承担过大的负载，热数据的问题通常要在业务上想办法解决，例如将一个键拆成多个键。

根据主键的分区会引入一个新的问题，假设一个储存汽车信息的表按照id分区了，那如果想按照颜色或者厂商之类的关键词查询车的信息则需要将查询请求发送到所有分区，或者将车的颜色索引单独存到一个分区里。如果将颜色信息存到一个分区里，那又可能引入一个新的瓶颈，同理还可以按照主键分区的方式，将二级索引也按照值范围进行分区存储。

分区的平衡：由于随着时间的推移，数据量和吞吐量的增大，原有的分区数量可能不能满足要求，为了应付增长，应该一开始就设置大量的分区数量，然后一个机器分配一定量的分区，增长后增加机器减少单个机器对应的分区数。分区和客户端可以增加一个路由，路由屏蔽掉分区对客户端调用的负责度。
